# Тихонов Илья 
# HSE‑Bank — модуль учёта финансов 
---

## Общая идея решения

Проект — консольное приложение на Go, которое ведёт учёт личных финансов и работает с тремя доменными сущностями:

- **BankAccount** — счёт (ID, имя, баланс);
- **Category** — категория операции (ID, имя, тип: *Spending* / *Income*);
- **Operation** — операция по счёту (ID, тип, категория, сумма, дата, заметка).

Поддержаны основные сценарии:

1. **CRUD** для `BankAccount`, `Category`, `Operation`.
2. **Импорт/экспорт** данных в **CSV/JSON/YAML** (реализовано отдельными модулями-стратегиями/визиторами).
3. **Простая аналитика**: агрегаты по категориям и периодам (суммы расходов/доходов, баланс).
4. **Персистентность** в **PostgreSQL** (через репозитории), а также **in‑memory** режим для быстрых тестов.
<!-- 5. **Логирование** и **валидация** через обёртки (декораторы/прокси) вокруг репозиториев/сервисов.
6. **DI‑сборка** (wire‑up) зависимостей через контейнер, выбор реализации по конфигу/ENV. -->

**Хранилище и запуск**: используется `docker-compose` с сервисами `db` (PostgreSQL 16‑alpine) и `app` (Go‑бинарь `bankservice`). . Файлы импорта/экспорта монтируются в `/app/files`.

---

## SOLID и GRASP в проекте

### SOLID

- **S (Single Responsibility)** — каждая сущность отвечает за своё:
  - `bankaccount`, `category`, `operation` — только бизнес‑данные и простые инварианты;
  - `repo/*` — только доступ к данным;
  - `export/*`, `import/*` — только форматы ввода/вывода;
  - `service` — агрегирует сценарии верхнего уровня.
- **O (Open/Closed)** — расширяем без модификации:
  - новые форматы экспорта/импорта добавляются реализацией интерфейса `Exporter`/`Importer` в отдельном пакете;
  - новые хранилища: добавить `repo/<impl>`.
- **L (Liskov Substitution)** — все реализации `Repository` взаимозаменяемы (`memory` ↔ `postgres`).
- **I (Interface Segregation)** — мелкие интерфейсы:
  - например, `Importer`, `DataFormatter`, отдельные интерфейсы для экспорта/импорта.
- **D (Dependency Inversion)** — уровень `service` зависит от **интерфейсов**, а детали (Postgres, CSV и т. п.) подставляются.

### GRASP

- **Information Expert** — вычисления агрегатов по категориям/балансу реализованы на слое сервисов, ближнем к данным.
- **Controller** — слой `service` принимает команды приложения (CLI) и координирует работу репозиториев/экспорта.
- **Creator** — мапперы/репозитории создают доменные объекты из DTO/строк БД.
- **Low Coupling / High Cohesion** — по пакетам разделены ответственности, зависимости идут через интерфейсы.
- **Polymorphism** — семейства импортеров/экспортеров/репозиториев.
- **Pure Fabrication** — `repo/*` как искусственный слой для изоляции БД.
- **Indirection** — `proxy/*` добавляет прослойки (логирование/валидация/кэш).
- **Protected Variations** — интерфейсы защищают от изменений конкретной БД/формата файлов.

---

## Реализованные паттерны GoF

| Паттерн | Где реализован | Зачем |
|---|---|---|
| **Strategy** | `export/{csv,json,yaml}`, `import/{csv,json,yaml}` | Подмена формата ввода/вывода без изменения клиентского кода. |
| **Factory Method / Abstract Factory** |  `repo.postgres` или `repo.memory`, фабрики экспорта | Централизованный выбор конкретных реализаций на основании конфигурации. |
| **Facade** | `service/` | Единая точка входа для сценариев (создать счёт, добавить операцию, экспорт и т. д.). |
| **Decorator** | `Timer` | Замеряет время выполнениея без  изменения основного кода. |
| **Proxy** | `proxy/cache`, `proxy/tx` | Кэширование чтения, транзакционные обёртки репозиториев. |
| **Adapter / Mapper** | `repo/postgres` (скан строк БД → доменные типы) | Согласование интерфейсов домена и драйвера БД. |
| **Visitor** | `export/*` (при обходе доменных коллекций) | Единый проход по моделям с разными способами сериализации. |

---

## Способы запуска

### Вариант 1 — Docker Compose (рекомендуется)

1. Установите Docker и Docker Compose.
2. В корне проекта выполните:
   ```bash
   docker compose up --build -d
   docker compose run app
   ```
3. Приложение стартует после `healthcheck` БД.
4. Для импорта/экспорта используйте каталог `./files` (смонтирован в контейнер как `/app/files`).

**Переменные окружения**:
```
DB_HOST=db
DB_PORT=5432
DB_NAME=bankservice
DB_USER=bankservice
DB_PASSWORD=password
```
### Вариант 2 — in‑memory режим

В main.go убираем создание postgresRepo и убираем коментарии для создание im-memory репозиториев

## Примеры сценариев использования (CLI)

Пример времени RFC3339
```
From: 2025-11-01T00:00:00+03:00
To: 2025-11-30T23:59:59+03:00
```

---

## Тестирование 
```bash
go test -v
```

---


