openapi: 3.0.3
info:
  title: Anti-Plagiarism Service API
  version: "1.0.0"
  description: Anti-plagiarism service for managing student works, submissions, and verification reports.

servers:
  - url: http://localhost:8080
    description: Local server

tags:
  - name: Works
  - name: Submissions
  - name: Reports
  - name: Stats

paths:
  /works:
    post:
      tags: [Works]
      summary: Create a work
      description: Create a new work (assignment) with the specified workId.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkCreateRequest'
            example:
              workId: "hw-kpo-3"
              name: "KPO HW-3"
              description: "Homework assignment for KPO course"
      responses:
        '201':
          description: Work successfully created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkResponse'
              example:
                workId: "hw-kpo-3"
                name: "KPO HW-3"
                description: "Homework assignment for KPO course"
                createdAt: "2025-11-26T12:00:00Z"
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "BAD_REQUEST"
                message: "workId and name are required"
        '409':
          description: Work with this workId already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "WORK_EXISTS"
                message: "Work with this workId already exists"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /works/{workId}/submissions:
    post:
      tags: [Submissions]
      summary: Submit work for review
      description: Student uploads a work file for the specified assignment (workId).
      parameters:
        - name: workId
          in: path
          required: true
          description: Work/assignment identifier
          schema:
            type: string
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [studentId, file]
              properties:
                studentId:
                  type: string
                  description: Student identifier
                file:
                  type: string
                  format: binary
                  description: Work file (PDF/DOCX/ZIP)
      responses:
        '201':
          description: Submission accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubmissionCreatedResponse'
              example:
                submissionId: "sub-001"
                workId: "hw-kpo-3"
                studentId: "student-123"
                status: "PENDING"
                uploadedAt: "2025-11-26T12:30:00Z"
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "BAD_REQUEST"
                message: "File and studentId are required"
        '404':
          description: Work not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "NOT_FOUND"
                message: "Work with this workId not found"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /works/{workId}/reports:
    get:
      tags: [Reports]
      summary: Get analytics by workId
      description: Get a list of reports/analytics for all submissions associated with the given workId.
      parameters:
        - name: workId
          in: path
          required: true
          description: Work identifier
          schema:
            type: string
      responses:
        '200':
          description: List of reports for the work
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WorkAnalyticsItem'
              example:
                - reportId: "rep-001"
                  submissionId: "sub-001"
                  studentId: "student-123"
                  status: "DONE"
                  plagiarismDetected: true
                  similarityPercent: 45.5
                  createdAt: "2025-11-26T13:00:00Z"
                - reportId: "rep-002"
                  submissionId: "sub-002"
                  studentId: "student-456"
                  status: "PENDING"
                  plagiarismDetected: false
                  similarityPercent: 0
                  createdAt: "2025-11-26T13:05:00Z"
        '404':
          description: Work not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "NOT_FOUND"
                message: "Work with this workId not found"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /submissions/{submissionId}:
    get:
      tags: [Submissions]
      summary: Get submission details
      description: Get detailed information about a specific work submission.
      parameters:
        - name: submissionId
          in: path
          required: true
          description: Submission identifier
          schema:
            type: string
      responses:
        '200':
          description: Submission details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubmissionDetail'
              example:
                submissionId: "sub-001"
                workId: "hw-kpo-3"
                studentId: "student-123"
                fileUrl: "/files/sub-001/work.pdf"
                uploadedAt: "2025-11-26T12:30:00Z"
                lastReport:
                  status: "DONE"
                  plagiarismDetected: true
                  similarityPercent: 45.5
        '404':
          description: Submission not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "NOT_FOUND"
                message: "Submission with this submissionId not found"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /works/{workId}/stats:
    get:
      tags: [Stats]
      summary: Get statistics by workId
      description: Return aggregated statistics for the work.
      parameters:
        - name: workId
          in: path
          required: true
          description: Work identifier
          schema:
            type: string
      responses:
        '200':
          description: Work statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkStats'
              example:
                workId: "hw-kpo-3"
                totalSubmissions: 50
                uniqueStudents: 48
                submissionsWithPlagiarism: 5
                submissionsWithoutPlagiarism: 45
                averageSimilarityPercent: 12.3
                lastSubmissionAt: "2025-11-26T15:00:00Z"
        '404':
          description: Work not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "NOT_FOUND"
                message: "Work with this workId not found"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    WorkCreateRequest:
      type: object
      required: [workId, name, description]
      properties:
        workId:
          type: string
          description: Unique work identifier
        name:
          type: string
          description: Work name
        description:
          type: string
          description: Work description

    WorkResponse:
      type: object
      required: [workId, name, description, createdAt]
      properties:
        workId:
          type: string
        name:
          type: string
        description:
          type: string
        createdAt:
          type: string
          format: date-time

    SubmissionCreatedResponse:
      type: object
      required: [submissionId, workId, studentId, status, uploadedAt]
      properties:
        submissionId:
          type: string
        workId:
          type: string
        studentId:
          type: string
        status:
          type: string
          enum: [PENDING, DONE, ERROR]
        uploadedAt:
          type: string
          format: date-time

    SubmissionDetail:
      type: object
      required: [submissionId, workId, studentId, fileUrl, uploadedAt]
      properties:
        submissionId:
          type: string
        workId:
          type: string
        studentId:
          type: string
        fileUrl:
          type: string
          description: URL for file download
        uploadedAt:
          type: string
          format: date-time
        lastReport:
          $ref: '#/components/schemas/ReportSummary'

    Report:
      type: object
      required: [reportId, submissionId, status, plagiarismDetected, similarityPercent, createdAt]
      properties:
        reportId:
          type: string
        submissionId:
          type: string
        status:
          type: string
          enum: [PENDING, DONE, ERROR]
        plagiarismDetected:
          type: boolean
        similarityPercent:
          type: number
          format: float
          minimum: 0
          maximum: 100
        createdAt:
          type: string
          format: date-time

    ReportSummary:
      type: object
      required: [status, plagiarismDetected, similarityPercent]
      properties:
        status:
          type: string
          enum: [PENDING, DONE, ERROR]
        plagiarismDetected:
          type: boolean
        similarityPercent:
          type: number
          format: float
          minimum: 0
          maximum: 100

    WorkAnalyticsItem:
      type: object
      required: [reportId, submissionId, studentId, status, plagiarismDetected, similarityPercent, createdAt]
      properties:
        reportId:
          type: string
        submissionId:
          type: string
        studentId:
          type: string
        status:
          type: string
          enum: [PENDING, DONE, ERROR]
        plagiarismDetected:
          type: boolean
        similarityPercent:
          type: number
          format: float
          minimum: 0
          maximum: 100
        createdAt:
          type: string
          format: date-time

    WorkStats:
      type: object
      required: [workId, totalSubmissions, uniqueStudents, submissionsWithPlagiarism, submissionsWithoutPlagiarism, averageSimilarityPercent]
      properties:
        workId:
          type: string
        totalSubmissions:
          type: integer
        uniqueStudents:
          type: integer
        submissionsWithPlagiarism:
          type: integer
        submissionsWithoutPlagiarism:
          type: integer
        averageSimilarityPercent:
          type: number
          format: float
        lastSubmissionAt:
          type: string
          format: date-time
          nullable: true

    ErrorResponse:
      type: object
      required: [code, message]
      properties:
        code:
          type: string
        message:
          type: string

